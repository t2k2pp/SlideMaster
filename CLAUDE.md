# SlideMaster プロジェクト - Claude 作業指針

このドキュメントは、ユーザーの要求に最高品質で応えるための行動指針です。

### 1. 職務遂行の基本原則

- **推測禁止**: 影響範囲を確認した上で行う。分からないことは「分からない」と伝える。推測で実装しない。
- **事実確認**: 外部APIの仕様、既存コード、指示内容は、必ず公式ドキュメントやGrep/Readで確認する。
- **指示の厳守**: ユーザーの指示範囲外の作業は一切行わない。「善意の越境」ユーザーへの確認を行わないものは、指示外の変更として禁止する。
- **品質の追求**: 指示された範囲内で、最高品質のコードとパフォーマンスを目指す。
### 2. 実装・リファクタリングガイドライン

#### **2-1. 実装前のチェック**

1. **指示内容の理解**: ユーザーはソースファイル単位ではなく、機能単位で依頼する。今対応している以外の機能もあるので関連しない処理を不要なものとして削除してはいけないし、別ファイルには関連する処理はないだろうと参照しないのはよくない。
2. **存在確認**: 使用する関数やファイル、APIパラメータが実際に存在するかを必ず確認する。
3. **計画の明示**: TodoListを作成し、作業範囲と「指示外の変更は行わない」旨を明示する。
    
#### **2-2. 実装後のチェック**
- 大きな修正をしたときはPlaywright でウエルカム画面が出る事だけは最低限確認をする。また、ユーザーの指示があった場合はそのほかのテストも実施する。
- npm run dev を実行しようとしない。それはユーザー行うもの。またユーザーが起動する場合は以下で起動されている。
	- http://localhost:5173/SlideMaster/
#### **2-3. 一般作業（新規実装・バグ修正）**

- **デザインパターン**: 生成AIの利用はファクトリパターンを基本とし、直接的なAPIコールを避ける。
- **プロンプト管理**: プロンプトは`contextIntelligence.yml`に外出しし、ハードコーディングしない。
- **AI通信**:   
    - APIキーはクエリパラメータではなく、セキュアなヘッダーに含める。
    - APIの応答形式（JSON/Markdown）に応じて、無駄な改行やスペースを省く指定を行う。
    - APIごとのMAXTOKENはアプリで管理し、ハードコーディングしない。
    - フォールバック処理でうまくいかない処理を無理やり通さない。
        
- **スライド生成**: 本文のMarp形式作成と、各ページのレイアウトAPIコールは、まとめて処理せずページごとに個別に行う。
    

#### **2-4. リファクタリング**

- **機能維持**: リファクタリングは「機能を削除せず、構造を改善すること」と定義する。
- **100%一致**: リファクタリング前後で、既存機能の動作が100%保持されていることを必ず確認する。
- **許可される作業**: 可読性向上を目的としたファイル分割、コンポーネントの責任分離、コードの重複排除、型安全性の向上に留める。
- **禁止事項**: 機能の追加・削除、UI動作の変更、警告メッセージやバリデーションの追加など、機能的な変更は一切禁止する。
    

### 3. 問題解決と迷った時の対処法

#### **3-1. 判断に迷った場合**

- **ユーザーに確認**: ユーザーの意図が不明な場合は、必ず確認を求める。
- **保守的に判断**: 指示の範囲内か再確認し、迷う場合は「やらない方」を選択する。
    

#### **3-2. 色・デザイン修正時**

- **元のコードを最優先**: ユーザーからの指摘を受けた場合は、まず元のコード（`_bk`）を確認し、元の設定に戻すことを最優先とする。
- **コントラスト確認**: 色を変更する際は、背景と文字のコントラスト比を考慮する。

### 4. 過去の教訓から学んだこと

- **存在確認の徹底**: 「あるはずだ」という思い込みを捨て、Grep/Readで存在確認を徹底する。
- **API仕様確認の徹底**: 公式ドキュメントなしにAPIのパラメータを追加・変更しない。
- **機能削除の禁止**: リファクタリング時に誤って既存機能を削除しないよう、事前の機能リストアップと事後の動作確認を徹底する。
- **UIの確認**: 処理を修正したときはUIの変更が必要かを確認する。