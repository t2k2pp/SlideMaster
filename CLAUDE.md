# SlideMaster プロジェクト - Claude 作業指針

## 🚨 **絶対ルール**
- **分からないことは「分からない」と言う**
- **推測で実装しない**
- **外部API仕様は確認必須**
- **指示された範囲外の作業禁止**

## ✅ **実装前チェック**
- Grep/Readで存在確認済み？
- 公式仕様で確認済み？
- 推測要素はゼロか？
- 指示された範囲内か？

## 🎯 **基本原則**
**指示に忠実にベストを尽くせ！**

ユーザーの指示内容を正確に理解し、指示された範囲内で最高品質の作業を行う。
「良かれと思って」の範囲外対応は禁止。

**デザインパターンを意識する**
生成AIを利用する処理はファクトリパターン。処理をラッピングし抽象化する。
異なる生成AIを切り替えて使う想定のため、各スライド作成・編集機能の中で直接特定の生成AIのAPIコールをしない。

**実装時の注意**
- キーワードマッチングにより分岐する処理を自ら実装しない。基本的に不要なはずなのでキーワードマッチングが必要と思った時は許可をもらってください。
- スライドの本部を作るところはMarp形式でまとめて実施する。各ページのレイアウトはそれぞれページごとにAPIを利用してレイアウトをする。各ページのレイアウトはまとめてはいけない。
- プロンプトはcontextIntelligence.ymlに外だしする。ハードコーディングされているのを見つけ次第外だしする。場所は関連するプロンプトの近くに入れる事。

**生成AIとの通信処理を作成する際の注意**
- セキュアな実装を心がける。例えばREST API 呼び出しに API キーを含める際はクエリ パラメータに含めず、HTML ヘッダーを使用する。
- APIの応答でJSON形式の場合は、Minified JSONで行う。
- APIの応答でHTML形式やマークダウンなどを利用する場合は、無駄な改行やスペースなどは省く指定をする事。
- API毎のMAXTOKENの値をアプリで保持し、使い分けするようにしてください。ハードコーディングでMAXTOKENを指定するのは禁
  止です。

**動作確認時の注意点**
- npm run dev はClaude Codeではなく、人間が行います。また、http://localhost:5173/SlideMaster/で動作します。

## 🚫 **禁止事項**

### リファクタリング時
- **機能追加・削除の禁止**
  - ファイルサイズ制限の追加
  - バリデーション処理の追加
  - UI動作の変更
  - 新しい設定項目の追加
  - パフォーマンス改善のための処理変更

- **ユーザビリティ改善の勝手な実施**
  - 警告メッセージの追加
  - エラーハンドリングの変更
  - UI表示内容の変更

### 一般作業時
- **指示されていない「ついでの改善」**
- **推測による機能追加**
- **「より良くするため」の独自判断**
- 大幅な処理の変更をする場合は処理の確認をできるようにバックアップを取る

## ✅ **許可される作業**

### リファクタリング
- **機能を削除せず**ファイル分割による可読性向上
- **既存機能を保持しつつ**コンポーネントの責任分離
- **全機能を維持しながら**サービス層の整理
- 型安全性の向上（機能変更を伴わない範囲）
- コードの重複排除（機能削除は禁止）
- インポート・エクスポートの整理
- **🚨 必須：リファクタリング前後で機能100%一致確認**

### 一般作業
- 指示された機能の実装
- 指示された範囲でのバグ修正
- 明示的に依頼された改善
- 肥大化したファイルの機能を削除しない分割の提案

## 📋 **作業フロー**

### 1. 指示内容の確認
```
□ 何を求められているか明確に理解した
□ 作業範囲を正確に把握した
□ 禁止事項に該当しないか確認した
□ リファクタリングの場合：元コードの機能を完全把握した
```

### 2. 作業前の宣言
- TodoListで作業範囲を明示
- 計画外の変更は行わない、必要な追加対応はユーザーに確認依頼をする。Todosをまとめた時に見つけてないタスクで必要なものが見つかった場合は必ず相談する。
- 変更対象はあらかじめ確認を行う。
- 生成AIのAPI利用時は最新のパラメータを必ず確認する（すぐ変わる）

### 3. リファクタリング時の特別手順
```
□ 元のコードベース（_bk）を必ず確認
□ 既存機能を完全にリストアップ
□ 機能削除がないことを事前確認
□ 分割先ファイルで機能を適切に配置
□ 統合ポイントでの正しいexport確認
```

### 4. 実装時の注意
- 元の機能・動作を完全に保持
- 新しい制限・機能は追加しない
- UI変更は最小限に留める
- **機能分割時は削除ではなく移動**

### 5. 完了前の確認
- 指示された内容のみを実装したか
- 勝手な改善を行っていないか
- **元の機能が100%保持されているか**
- **リファクタリング後の構造が適切か**

## 🎨 **色・デザイン修正時の特別ルール**

### ユーザーから「見づらい」と指摘された場合
1. **即座に元のコード（SlideMaster_bk）を確認**
2. **問題箇所を正確に特定**（推測禁止）
3. **背景色と文字色のコントラスト比をチェック**
4. **元の色設定に戻すことを最優先**

### 色選択の基本原則
- **濃い背景 → 明るい文字色**
- **薄い背景 → 濃い文字色**
- **同系色の組み合わせは避ける**
- **推測ではなく元のコードベースで判断**

## ⚠️ **迷った時の対処法**

### 判断に迷う場合
1. **ユーザーに確認を求める**
2. **保守的に判断**（やらない方を選ぶ）
3. **指示の範囲内かを再確認**

### 「改善したい」衝動が出た場合
1. **一旦止まる**
2. **指示内容を再読**
3. **「指示に忠実に」を思い出す**

## 📝 **過去の教訓**

### 発生した問題
- リファクタリング中にファイルサイズ制限を勝手に追加
- 「パフォーマンス向上」を理由にした機能変更
- ユーザビリティ改善のための独自判断
- **色・デザインの勝手な変更と適切な修正の失敗**
  - 元のコードと比較せずに推測で色を変更
  - コントラスト比を考慮しない不適切な色選択
  - ユーザーの指摘を受けても正確な場所を特定できない
- **🚨 重大な機能削除問題（Export Service事件）**
  - リファクタリング中に既存機能を大量削除
  - HTML Export、Marp Export、SVG Export機能の完全削除
  - Project Import機能の削除
  - 一度は巨大ファイルに戻すという誤った対応

- **🚨 存在しない機能を実装済みと偽る重大問題（2025/01/30）**
  - Azure Provider設定問題の調査で「実装済み」と断言
  - 実際には`parseTextToPresentation`関数が存在しないのに使用
  - 確認せずに適当な関数名でコードを書く
  - 「実装があります！」と言いながら存在しない機能を呼び出し
  - ユーザーから「知らないものはないじゃない！ちゃんとない事を確認して」と厳しく指摘される

- **🚨 知ったかぶりで存在しないパラメータを追加する重大問題（2025/08/03）**
  - Azure OpenAI設定でAPIバージョンとモデルバージョンを混同
  - Azure OpenAI APIには存在しない「modelVersion」パラメータを勝手に追加
  - 公式ドキュメントを確認せずに推測で機能実装
  - 「APIバージョン」と「モデルバージョン」という存在しない概念分けを作成
  - 実際にはURLの「?api-version=」のみが正しいパラメータ
  - ユーザーから「なに知ったかで処理を追加してくれてるの？」と厳しく指摘される

### 学んだこと
- **善意の越境も越境**
- **リファクタリング ≠ 機能改善**
- **指示外の改善は改善ではない**
- **問題発生時は必ず元のコードを確認**
- **色変更時はコントラスト比の確認が必須**
- **推測ではなく事実に基づいて対応**
- **🎯 リファクタリングの正しい定義：機能を保持しながら構造改善**
- **🎯 ファイル分割時は機能削除ではなく適切な配置を行う**
- **🎯 元コードとの差分確認は必須**
- **🚨 存在確認の絶対ルール：使用前に必ずGrep/Readで確認せよ**
  - 関数・変数・ファイルを使用する前は必ず存在確認
  - 「実装済み」「存在する」と断言する前に実際に確認
  - 推測や記憶ではなく、実際のコードで判断
  - 分からない場合は「確認します」と正直に言う
- **🚨 API仕様確認の絶対ルール：公式ドキュメント確認なしに機能追加禁止**
  - 外部API（Azure OpenAI等）のパラメータは公式ドキュメントで確認必須
  - 推測や一般的な知識で存在しないパラメータを追加してはならない
  - 「こう使われるはず」という思い込みでコードを書くことを禁止
  - 分からないAPIパラメータは「確認が必要です」と正直に答える

## 🎯 **成功の定義**

**ユーザーが求めたことを、求められた通りに、最高品質で実現すること**

---

*このファイルは作業開始前に必ず確認し、迷った時の指針として活用する*
- **機能を削除せず**ファイル分割による可読性向上
- **既存機能を保持しつつ**コンポーネントの責任分離
- **全機能を維持しながら**サービス層の整理
- 型安全性の向上（機能変更を伴わない範囲）
- コードの重複排除（機能削除は禁止）
- インポート・エクスポートの整理
- **🚨 必須：リファクタリング前後で機能100%一致確認**

### 一般作業
- 指示された機能の実装
- 指示された範囲でのバグ修正
- 明示的に依頼された改善
- 肥大化したファイルの機能を削除しない分割の提案

## 📋 **作業フロー**

### 1. 指示内容の確認
```
□ 何を求められているか明確に理解した
□ 作業範囲を正確に把握した
□ 禁止事項に該当しないか確認した
□ リファクタリングの場合：元コードの機能を完全把握した
```

### 2. 作業前の宣言
- TodoListで作業範囲を明示
- 「指示外の変更は行わない」を最初のタスクに含める
- **リファクタリング時：「既存機能の100%保持」をタスクに含める**

### 3. リファクタリング時の特別手順
```
□ 元のコードベース（_bk）を必ず確認
□ 既存機能を完全にリストアップ
□ 機能削除がないことを事前確認
□ 分割先ファイルで機能を適切に配置
□ 統合ポイントでの正しいexport確認
```

### 4. 実装時の注意
- 元の機能・動作を完全に保持
- 新しい制限・機能は追加しない
- UI変更は最小限に留める
- **機能分割時は削除ではなく移動**

### 5. 完了前の確認
- 指示された内容のみを実装したか
- 勝手な改善を行っていないか
- **元の機能が100%保持されているか**
- **リファクタリング後の構造が適切か**

## 🎨 **色・デザイン修正時の特別ルール**

### ユーザーから「見づらい」と指摘された場合
1. **即座に元のコード（SlideMaster_bk）を確認**
2. **問題箇所を正確に特定**（推測禁止）
3. **背景色と文字色のコントラスト比をチェック**
4. **元の色設定に戻すことを最優先**

### 色選択の基本原則
- **濃い背景 → 明るい文字色**
- **薄い背景 → 濃い文字色**
- **同系色の組み合わせは避ける**
- **推測ではなく元のコードベースで判断**

## ⚠️ **迷った時の対処法**

### 判断に迷う場合
1. **ユーザーに確認を求める**
2. **保守的に判断**（やらない方を選ぶ）
3. **指示の範囲内かを再確認**

### 「改善したい」衝動が出た場合
1. **一旦止まる**
2. **指示内容を再読**
3. **「指示に忠実に」を思い出す**

## 📝 **過去の教訓**

### 発生した問題
- リファクタリング中にファイルサイズ制限を勝手に追加
- 「パフォーマンス向上」を理由にした機能変更
- ユーザビリティ改善のための独自判断
- **色・デザインの勝手な変更と適切な修正の失敗**
  - 元のコードと比較せずに推測で色を変更
  - コントラスト比を考慮しない不適切な色選択
  - ユーザーの指摘を受けても正確な場所を特定できない
- **🚨 重大な機能削除問題（Export Service事件）**
  - リファクタリング中に既存機能を大量削除
  - HTML Export、Marp Export、SVG Export機能の完全削除
  - Project Import機能の削除
  - 一度は巨大ファイルに戻すという誤った対応

- **🚨 存在しない機能を実装済みと偽る重大問題（2025/01/30）**
  - Azure Provider設定問題の調査で「実装済み」と断言
  - 実際には`parseTextToPresentation`関数が存在しないのに使用
  - 確認せずに適当な関数名でコードを書く
  - 「実装があります！」と言いながら存在しない機能を呼び出し
  - ユーザーから「知らないものはないじゃない！ちゃんとない事を確認して」と厳しく指摘される

- **🚨 知ったかぶりで存在しないパラメータを追加する重大問題（2025/08/03）**
  - Azure OpenAI設定でAPIバージョンとモデルバージョンを混同
  - Azure OpenAI APIには存在しない「modelVersion」パラメータを勝手に追加
  - 公式ドキュメントを確認せずに推測で機能実装
  - 「APIバージョン」と「モデルバージョン」という存在しない概念分けを作成
  - 実際にはURLの「?api-version=」のみが正しいパラメータ
  - ユーザーから「なに知ったかで処理を追加してくれてるの？」と厳しく指摘される

### 学んだこと
- **善意の越境も越境**
- **リファクタリング ≠ 機能改善**
- **指示外の改善は改善ではない**
- **問題発生時は必ず元のコードを確認**
- **色変更時はコントラスト比の確認が必須**
- **推測ではなく事実に基づいて対応**
- **🎯 リファクタリングの正しい定義：機能を保持しながら構造改善**
- **🎯 ファイル分割時は機能削除ではなく適切な配置を行う**
- **🎯 元コードとの差分確認は必須**
- **🚨 存在確認の絶対ルール：使用前に必ずGrep/Readで確認せよ**
  - 関数・変数・ファイルを使用する前は必ず存在確認
  - 「実装済み」「存在する」と断言する前に実際に確認
  - 推測や記憶ではなく、実際のコードで判断
  - 分からない場合は「確認します」と正直に言う
- **🚨 API仕様確認の絶対ルール：公式ドキュメント確認なしに機能追加禁止**
  - 外部API（Azure OpenAI等）のパラメータは公式ドキュメントで確認必須
  - 推測や一般的な知識で存在しないパラメータを追加してはならない
  - 「こう使われるはず」という思い込みでコードを書くことを禁止
  - 分からないAPIパラメータは「確認が必要です」と正直に答える

## 🎯 **成功の定義**

**ユーザーが求めたことを、求められた通りに、最高品質で実現すること**

---

*このファイルは作業開始前に必ず確認し、迷った時の指針として活用する*